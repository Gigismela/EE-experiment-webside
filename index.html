<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EE — Experiment Demo Store (2 min)</title>
  <style>
    :root{--accent:#2563eb;--muted:#6b7280;--bg:#f7f8fb}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0;background:var(--bg);color:#111}
    .timer{font-weight:700;color:#111}
    .btn{background:white;border:1px solid #e6e6e9;padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn.primary{ background: #555;color: white;border: none;}
    main{padding:18px 22px}
    .grid{display:flex;flex-direction:column;gap:20px;align-items:centre}
    .product{background:white;border-radius:12px;padding:12px;box-shadow:0 1px 6px rgba(2,6,23,0.04);display:flex;flex-direction:row;gap:20px;width:1100px;align-items:flex-start}
    .img{width:200px;height:200px;border-radius:8px;background:linear-gradient(135deg,#f3f4f6,#e6eefc);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700}
    .row{display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    .long-desc {font-size: 14px;color: #6b7280;margin: 8px 0 12px 0;width:100%}
    #codeBtn {background-color:#555;color:white;border:none;padding:10px 20px;border-radius:12px;cursor:pointer;font-weight:700;font-size:16px;display:none;margin-top:20px}
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:60}
    .modal{width:420px;background:white;border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.2)}
    .cart-list{max-height:260px;overflow:auto;margin-top:8px}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f1f2}

    /* checkout form */
    .form-row{display:flex;gap:8px}
    .field{flex:1;display:flex;flex-direction:column;gap:6px}
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #e6e6e9}
    .expired{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:80;color:white}
    .expired .card{background:transparent;color:white;text-align:center}
    footer{padding:18px 22px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:520px){.modal{width:92vw}}
    header {position: sticky;top: 0;z-index: 100;display: flex;align-items: center;justify-content: space-between;padding: 10px 22px;background: white;box-shadow: 0 2px 8px rgba(2,6,23,0.1)}
    .header-left {display: flex;align-items: center;}
    .header-right {display: flex;align-items: center;gap: 20px;}
    .timer {font-weight: 800;font-size: 22px;}
    .cart-btn {display: flex;align-items: center;gap: 6px;background: none;border: none;cursor: pointer;}
    .cart-icon {width: 42px;height: 42px;}
    .cart-icon.disabled {filter: grayscale(100%) brightness(60%);opacity: 0.5;}
    #cartCount {font-size: 18px;font-weight: 700;color: #111;margin-left: 4px;}
    .header-shaded {background: rgba(0, 0, 0, 0.6);pointer-events: none;}
    .banner-wrapper {position: relative;width: 100%;max-width: 1200px;height: 200px;}
    .banner-img {width: 100%;height: 100%;object-fit: cover;border-radius: 8px;display: block}
    .banner-overlay {position: absolute; inset: 0;background: rgba(0, 0, 0, 0.6);border-radius: 8px;display: none;z-index: 1;opacity: 0;transition: opacity 0.5s ease;}
    .banner-overlay.show {opacity: 1;}
    #notification {position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);background: #111;color: #fff;padding: 14px 20px;border-radius: 10px;font-weight: 600;font-size: 15px;z-index: 1000;opacity: 0;transition: opacity 0.6s ease-in-out;pointer-events: none;max-width: 90%;width: max-content;box-shadow: 0 6px 12px rgba(0,0,0,0.2);}
    .btn.primary:hover,
    #codeBtn:hover {background-color: #444;}
    #formBtn {background-color: #555;color: color: white;border: none;padding: 10px 20px;border-radius: 12px;cursor: pointer;font-weight: 700;font-size: 16px;display:inline-block;margin-top: 20px;text-decoration: none;}
    #formBtn:hover {background-color: #444;}
    
  </style>
</head>
<body>
 <header>
 <div class="header-left banner-wrapper">
  <img src="Eternal.jpg" alt="Banner" class="banner-img">
  <div class="banner-overlay"></div>
</div>
  <div class="header-right">
    <div class="timer" id="timer">02:00</div>
    <button id="cartBtn" class="cart-btn">
      <img src="Untitled design-2.jpg" alt="Cart" class="cart-icon">
      <span id="cartCount">(0)</span>
    </button>
  </div>
</header>

  <main>
    <section>
      <h2 style="margin-top:0">OUR PRODUCTS</h2>
      <div class="grid" id="products"></div>
    </section>
  </main>

  <!-- Cart Modal -->
  <div id="cartOverlay" class="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Your Cart</h3>
        <button id="closeCart" class="btn">Close</button>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div style="font-weight:700">Total: <span id="cartTotal">$0.00</span></div>
        <div>
          <button id="checkoutOpen" class="btn primary">Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div id="checkoutOverlay" class="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Checkout</h3>
        <button id="closeCheckout" class="btn">Close</button>
      </div>

      <form id="checkoutForm" style="margin-top:10px">
        <div style="display:flex;gap:10px">
          <div style="flex:1" class="field">
            <label>Name</label>
            <input id="c_name" required />
          </div>
          <div style="flex:1" class="field">
            <label>Email</label>
            <input id="c_email" type="email" required />
          </div>
        </div>

        <div style="margin-top:8px" class="field">
          <label>Shipping address</label>
          <input id="c_address" placeholder="Street, house no." required />
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="c_city" class="field" placeholder="City" required />
          <input id="c_postal" class="field" placeholder="Postal code" required />
        </div>

      <hr style="margin:12px 0" />
    <div style="color:var(--muted);font-size:13px;margin-bottom:8px">It is not required to input real information in this section.</div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="muted">Total: <strong id="checkoutTotal">$0.00</strong></div>
          <button type="submit" class="btn primary">Place order</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Expired Overlay -->
  <div id="expiredOverlay" class="expired">
  <div class="card">
    <h2 style="margin:0 0 8px 0">Session expired</h2>
    <div style="max-width:540px">
      Thank you for volunteering to take part in this experiment. Please fill in the form attached below.
    </div>
    <div style="margin-top:12px; display: flex; gap: 12px; justify-content: center;">
      <button id="codeBtn">CODE</button>
      <a id="formBtn" class="btn gray" href="https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=hwG7uirk5U6FtsrhKvQi5NFIX1m4SaBOsbVA-bkf2mtUMEpORzg1TkVJUDI1R1AyU1VRN1RDNEU0VS4u" target="_blank">FORM</a>
    </div>
  </div>
</div>

  <div id="confirmationOverlay" class="overlay" style="display:none">
    <div class="modal">
      <h3>Order confirmed</h3>
      <div id="orderSummary"></div>
      <div style="margin-top:12px;display:flex;justify-content:flex-end">
        <button id="closeConfirmation" class="btn primary">Done</button>
      </div>
    </div>
  </div>

  <footer>
    Site designed for the purpose of an experiment. No real payments are charged.
  </footer>

  <audio id="notifSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a2435d3b3.mp3?filename=pop-up-alert-141072.mp3" preload="auto"></audio>
  
<script>
(function(){
  // ====== CONFIG ======
  const SESSION_MS = 2 * 60 * 1000; // 2 minutes
  const START_KEY = 'demoStart_EE---experiment-webside';

  // ====== ELEMENTS ======
  const productsEl = document.getElementById('products');
  const cartBtn = document.getElementById('cartBtn');
  const cartOverlay = document.getElementById('cartOverlay');
  const closeCart = document.getElementById('closeCart');
  const cartList = document.getElementById('cartList');
  const cartTotalEl = document.getElementById('cartTotal');
  const checkoutOpen = document.getElementById('checkoutOpen');
  const checkoutOverlay = document.getElementById('checkoutOverlay');
  const closeCheckout = document.getElementById('closeCheckout');
  const checkoutForm = document.getElementById('checkoutForm');
  const checkoutTotal = document.getElementById('checkoutTotal');
  const timerEl = document.getElementById('timer');
  const expiredOverlay = document.getElementById('expiredOverlay');
  const codeBtn = document.getElementById('codeBtn');
  const confirmationOverlay = document.getElementById('confirmationOverlay');
  const orderSummary = document.getElementById('orderSummary');
  const closeConfirmation = document.getElementById('closeConfirmation');

  // ====== STATE ======
  let cart = JSON.parse(localStorage.getItem('demoCart') || '[]');
  let isExpired = false;
  let codeEntered = false;  // <-- new flag to track if the CODE button was successfully used


  // ====== PRODUCTS ======
  const PRODUCTS = [
    { id:'p1', title:'Black Hoodie 1', price:49.99, desc:'avaiable now', longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material', images: ['1.jpg', '2.jpg'] },
    { id:'p3', title:'Black Hoodie 2', price:49.99, longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material',images: ['5.jpg', '6.jpg'] },
    { id:'p2', title:'Black Hoodie 3', price:49.99, desc:'BESTSELLER', longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material',images: ['3.jpg', '4.jpg'] },
    { id:'p4', title:'Black Hoodie 4', price:49.99, desc:'in stock', longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material',images: ['9.jpg', '10.jpg'] },
    { id:'p5', title:'Black Hoodie 5', price:49.99, longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material',images: ['7.jpg', '8.jpg'] },
    { id:'p6', title:'Black Hoodie 6', price:49.99, desc:'LAST 2 LEFT', longDesc:'This product is a unisex hoddie with an original design made out of 100% organic material',images: ['11.jpg', '12.jpg'] }
  ];

  // ====== HELPERS ======
  function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
  function saveCart(){ localStorage.setItem('demoCart', JSON.stringify(cart)); }
  function ensureStart(){
    let start = localStorage.getItem(START_KEY);
    if(!start){ start = Date.now(); localStorage.setItem(START_KEY, String(start)); }
    return Number(start);
  }

 function showNotification(message) {
  const notif = document.getElementById('notification');
  notif.textContent = `✅ ${message}`;  // Use textContent instead of innerHTML
  notif.style.opacity = '1';
  notif.style.pointerEvents = 'auto'; // Enable interaction while visible (optional)

  // Play sound
  const sound = document.getElementById('notifSound');
  if (sound) sound.play();

  // Clear existing timeout if active
  if (window._notifTimer) clearTimeout(window._notifTimer);

  // Hide after 5 seconds
  window._notifTimer = setTimeout(() => {
    notif.style.opacity = '0';
    notif.style.pointerEvents = 'none';  // <-- Add this here
  }, 2000);
}


  // ====== RENDER PRODUCTS ======
  function renderProducts(){
    productsEl.innerHTML = PRODUCTS.map(p => `
      <div class="product" data-id="${p.id}">
       <div style="display:flex;gap:40px;flex-direction:row;justify-content:flex-start">
  <div style="text-align:center">
    <img src="${p.images[0]}" alt="${escapeHtml(p.title)} Front" style="width:400px;height:400px;object-fit:cover;border-radius:8px"/>
    <div style="font-size:12px;color:var(--muted)">Front</div>
  </div>
  <div style="text-align:center">
    <img src="${p.images[1]}" alt="${escapeHtml(p.title)} Back" style="width:400px;height:400px;object-fit:cover;border-radius:8px"/>
    <div style="font-size:12px;color:var(--muted)">Back</div>
  </div>
</div>
       <div style="flex:1; display:flex; flex-direction:column; justify-content:space-between; padding-left:12px; padding-right:12px; margin-top:12px">
  <div>
    <div style="font-weight:800">${escapeHtml(p.title)}</div>
    ${p.desc ? `<div class="ribbon" style="
    font-size:16px;
    font-weight:700;
    margin-top:4px;
    color:${(p.id==='p2'||p.id==='p6') ? '#ff000d' : 'var(--muted)'};
">${escapeHtml(p.desc)}</div>` : ''}
    <div class="long-desc" style="margin-top:8px">${escapeHtml(p.longDesc || '')}</div>
  </div>
  <div class="row" style="margin-top:12px">
    <div style="font-weight:700">$${p.price.toFixed(2)}</div>
    <div><button class="btn addBtn" data-id="${p.id}">Add</button></div>
  </div>
</div>
      </div>
    `).join('');

    document.querySelectorAll('.addBtn').forEach(btn => {
  btn.addEventListener('click', ()=>{
    if(isExpired) return alert('Session expired');
    const id = btn.dataset.id;
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    const existing = cart.find(i=>i.id===id);
    if(existing) {
      existing.qty += 1;
    } else {
      cart.push({id:p.id,title:p.title,price:p.price,qty:1});
    }
    saveCart(); updateCartUI();
    showNotification(`Product ${p.title} added to the cart`);
  });
});

  }

  // ====== CART ======
  function updateCartUI() {
  document.getElementById('cartCount').textContent = `(${cart.reduce((s,i)=>s+i.qty,0)})`;
}

  function renderCartList(){
    if(cart.length===0){ cartList.innerHTML = '<div class="muted">Your cart is empty.</div>'; cartTotalEl.textContent='$0.00'; checkoutOpen.disabled=true; return; }
    checkoutOpen.disabled=false;
    cartList.innerHTML = cart.map(item => `
      <div class="cart-item">
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(item.title)}</div>
          <div class="muted">Qty: <strong>${item.qty}</strong></div>
        </div>
        <div style="text-align:right">
          <div>$${(item.price*item.qty).toFixed(2)}</div>
          <div style="margin-top:6px">
            <button class="btn small" data-act="dec" data-id="${item.id}">-</button>
            <button class="btn small" data-act="inc" data-id="${item.id}">+</button>
            <button class="btn" data-act="rem" data-id="${item.id}">Remove</button>
          </div>
        </div>
      </div>
    `).join('');
    cartList.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.dataset.id; const act = b.dataset.act;
        const idx = cart.findIndex(x=>x.id===id);
        if(idx===-1) return;
        if(act==='dec'){ cart[idx].qty = Math.max(1, cart[idx].qty-1); }
        if(act==='inc'){ cart[idx].qty += 1; }
        if(act==='rem'){ cart.splice(idx,1); }
        saveCart(); renderCartList(); updateCartUI();
      });
    });
    const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
    cartTotalEl.textContent = '$' + total.toFixed(2);
  }
  function openCart(){ renderCartList(); cartOverlay.style.display='flex'; }
  function closeCartFn(){ cartOverlay.style.display='none'; }

  // ====== CHECKOUT ======
  function openCheckout(){ 
    if(isExpired) return alert('Session expired');
    if(cart.length===0) return alert('Cart is empty');
    checkoutOverlay.style.display='flex';
    checkoutTotal.textContent = '$' + cart.reduce((s,i)=>s+i.price*i.qty,0).toFixed(2);
  }
  function closeCheckoutFn(){ checkoutOverlay.style.display='none'; }

  checkoutForm.addEventListener('submit', e=>{
    e.preventDefault();
    if(isExpired) return alert('Session expired');
    const name = document.getElementById('c_name').value.trim();
    const email = document.getElementById('c_email').value.trim();
    const address = document.getElementById('c_address').value.trim();
    if(!name||!email||!address) return alert('Please fill name, email and address (demo).');

    const order = {
      id: 'EE-' + Math.random().toString(36).slice(2,10).toUpperCase(),
      name, email, address,
      items: cart.slice(),
      total: cart.reduce((s,i)=>s+i.price*i.qty,0).toFixed(2),
      time: new Date().toISOString()
    };

    orderSummary.innerHTML = `<div><strong>Order ID:</strong> ${order.id}</div>
      <div style="margin-top:8px"><strong>Items:</strong><ul>` +
      order.items.map(it=>`<li>${escapeHtml(it.title)} × ${it.qty} — $${(it.price*it.qty).toFixed(2)}</li>`).join('') + `</ul></div>
      <div style="margin-top:8px"><strong>Total:</strong> $${order.total}</div>
    `;
    cart = []; saveCart(); updateCartUI();
    checkoutOverlay.style.display='none';
    confirmationOverlay.style.display='flex';
  });
  closeConfirmation.addEventListener('click', ()=>{ confirmationOverlay.style.display='none'; cartOverlay.style.display = 'none';showFinalThankYouScreen();});

  // ====== TIMER & SESSION ======
  let startTs = ensureStart();
 function updateTimer(){
  const elapsed = Date.now() - startTs;
  const remaining = Math.max(0, SESSION_MS - elapsed);
  const mm = String(Math.floor(remaining/60000)).padStart(2,'0');
  const ss = String(Math.floor((remaining%60000)/1000)).padStart(2,'0');
  timerEl.textContent = `${mm}:${ss}`;

  // Only expire session if not yet expired AND code has not been entered
  if(remaining <= 0 && !isExpired && !codeEntered) expireSession();
}

  function expireSession(){
    isExpired = true;
    expiredOverlay.style.display = 'flex';
    document.querySelector('header').classList.add('header-shaded');
   const overlay = document.querySelector('.banner-overlay');
    overlay.style.display = 'block';
    requestAnimationFrame(() => overlay.classList.add('show'));
    document.querySelectorAll('button').forEach(b=>{ if(b.id!=='codeBtn') b.disabled = true; });
    document.querySelector('.cart-icon').classList.add('disabled');
    document.querySelectorAll('input,textarea,select').forEach(i=>i.disabled = true);
    codeBtn.style.display = 'inline-block';
    codeBtn.disabled = false;
  }

  timerEl.addEventListener('click', e=>{
    if(e.shiftKey){
      localStorage.removeItem(START_KEY);
      startTs = ensureStart();
      isExpired=false;
      document.querySelectorAll('button,input,textarea,select').forEach(el=>el.disabled=false);
      expiredOverlay.style.display='none';
      updateTimer();
      alert('Demo timer reset (developer).');
    }
  });

  function showFinalThankYouScreen() {
  isExpired = true;
  codeBtn.style.display = 'inline-block';
  codeBtn.disabled = false;
  expiredOverlay.style.display = 'flex';
  document.querySelector('header').classList.add('header-shaded');

  const overlay = document.querySelector('.banner-overlay');
  overlay.style.display = 'block';
  requestAnimationFrame(() => overlay.classList.add('show'));

  // Disable everything except CODE button
  document.querySelectorAll('button').forEach(b => {
    if (b.id !== 'codeBtn') b.disabled = true;
  });
  document.querySelectorAll('input, textarea, select').forEach(i => i.disabled = true);
  document.querySelector('.cart-icon').classList.add('disabled');

  // ✅ Change the message
  const expiredCard = document.querySelector('#expiredOverlay .card');
  expiredCard.innerHTML = `
    <h2 style="margin:0 0 8px 0">Thank you for taking part in this experiment</h2>
    <div style="max-width:540px">Please fill in the form attached below.</div>
    <div style="margin-top:12px; display: flex; gap: 12px; justify-content: center;">
      <button id="codeBtn" style="display:inline-block">CODE</button>
      <a id="formBtn" class="btn gray" href="https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=hwG7uirk5U6FtsrhKvQi5NFIX1m4SaBOsbVA-bkf2mtUMEpORzg1TkVJUDI1R1AyU1VRN1RDNEU0VS4u" target="_blank">FORM</a>
    </div>
  `;

  // Re-bind the CODE button
  document.getElementById('codeBtn').addEventListener('click', () => {
    const userCode = prompt("Enter code to continue:");
    if (userCode === "12345") {
      expiredOverlay.style.display = 'none';
      const overlay = document.querySelector('.banner-overlay');
      overlay.classList.remove('show');
      setTimeout(() => overlay.style.display = 'none', 500);
      codeBtn.style.display = 'none';
      document.querySelectorAll('button,input,textarea,select').forEach(el => el.disabled = false);
      document.querySelector('.cart-icon').classList.remove('disabled');
      isExpired = false;
      codeEntered = true;
      updateCartUI();
      alert("Access granted! You can continue.");
    } else {
      alert("Incorrect code!");
    }
    document.querySelector('header').classList.remove('header-shaded');
  });
}

  // ====== UI EVENTS ======
  cartBtn.addEventListener('click', openCart);
  closeCart.addEventListener('click', closeCartFn);
  checkoutOpen.addEventListener('click', openCheckout);
  closeCheckout.addEventListener('click', closeCheckoutFn);

  // ====== CODE BUTTON ======
  codeBtn.addEventListener('click', ()=>{
  const userCode = prompt("Enter code to continue:");
  if(userCode==="12345"){
    expiredOverlay.style.display='none';
    const overlay = document.querySelector('.banner-overlay');
    overlay.classList.remove('show');
    setTimeout(() => overlay.style.display = 'none', 500);
    codeBtn.style.display='none';

    // Re-enable all buttons, inputs, textareas, selects
    document.querySelectorAll('button,input,textarea,select').forEach(el=>el.disabled=false);
    document.querySelector('.cart-icon').classList.remove('disabled');

    // Mark session as unlocked
    isExpired = false;
    codeEntered = true;  // <-- important, prevents overlay from appearing again

    // Update cart UI
    updateCartUI();

    alert("Access granted! You can continue.");
  } else {
    alert("Incorrect code!");
  }
    document.querySelector('header').classList.remove('header-shaded');
});

  // ====== INIT ======
  renderProducts();
  updateCartUI();
  updateTimer();
  setInterval(updateTimer, 250);

})();
</script>
  <div id="notification" role="status" aria-live="polite"></div>
</body>
</html>
